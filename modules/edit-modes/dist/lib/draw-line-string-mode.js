"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DrawLineStringMode = void 0;

var _geojsonEditMode = require("./geojson-edit-mode.js");

var _immutableFeatureCollection = require("./immutable-feature-collection.js");

class DrawLineStringMode extends _geojsonEditMode.BaseGeoJsonEditMode {
  handleClickAdapter(event, props) {
    super.handleClickAdapter(event, props);
    var editAction = null;
    var selectedFeatureIndexes = props.selectedIndexes;
    var selectedGeometry = this.getSelectedGeometry(props);
    var tentativeFeature = this.getTentativeFeature();
    var clickSequence = this.getClickSequence();

    if (selectedFeatureIndexes.length > 1 || selectedGeometry && selectedGeometry.type !== 'LineString') {
      console.warn("drawLineString mode only supported for single LineString selection"); // eslint-disable-line

      this.resetClickSequence();
      return null;
    }

    if (selectedGeometry && selectedGeometry.type === 'LineString') {
      // Extend the LineString
      var lineString = selectedGeometry;
      var positionIndexes = [lineString.coordinates.length];
      var modeConfig = props.modeConfig;

      if (modeConfig && modeConfig.drawAtFront) {
        positionIndexes = [0];
      }

      var featureIndex = selectedFeatureIndexes[0];
      var updatedData = new _immutableFeatureCollection.ImmutableFeatureCollection(props.data).addPosition(featureIndex, positionIndexes, event.mapCoords).getObject();
      editAction = {
        updatedData: updatedData,
        editType: 'addPosition',
        editContext: {
          featureIndexes: [featureIndex],
          positionIndexes: positionIndexes,
          position: event.mapCoords
        }
      };
      this.resetClickSequence();
    } else if (clickSequence.length === 2 && tentativeFeature) {
      // Add a new LineString
      var geometry = tentativeFeature.geometry;
      editAction = this.getAddFeatureAction(geometry, props.data);
      this.resetClickSequence();
    }

    return editAction;
  }

  handlePointerMoveAdapter(event, props) {
    var result = {
      editAction: null,
      cancelMapPan: false
    };
    var clickSequence = this.getClickSequence();
    var mapCoords = event.mapCoords;
    var startPosition = null;
    var selectedFeatureIndexes = props.selectedIndexes;
    var selectedGeometry = this.getSelectedGeometry(props);

    if (selectedFeatureIndexes.length > 1 || selectedGeometry && selectedGeometry.type !== 'LineString') {
      // unsupported
      return result;
    }

    if (selectedGeometry && selectedGeometry.type === 'LineString') {
      // Draw an extension line starting from one end of the selected LineString
      startPosition = selectedGeometry.coordinates[selectedGeometry.coordinates.length - 1];
      var modeConfig = props.modeConfig;

      if (modeConfig && modeConfig.drawAtFront) {
        startPosition = selectedGeometry.coordinates[0];
      }
    } else if (clickSequence.length === 1) {
      startPosition = clickSequence[0];
    }

    if (startPosition) {
      this._setTentativeFeature({
        type: 'Feature',
        properties: {},
        geometry: {
          type: 'LineString',
          coordinates: [startPosition, mapCoords]
        }
      });
    }

    return result;
  }

  getCursorAdapter() {
    return 'cell';
  }

}

exports.DrawLineStringMode = DrawLineStringMode;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvZHJhdy1saW5lLXN0cmluZy1tb2RlLmpzIl0sIm5hbWVzIjpbIkRyYXdMaW5lU3RyaW5nTW9kZSIsIkJhc2VHZW9Kc29uRWRpdE1vZGUiLCJoYW5kbGVDbGlja0FkYXB0ZXIiLCJldmVudCIsInByb3BzIiwiZWRpdEFjdGlvbiIsInNlbGVjdGVkRmVhdHVyZUluZGV4ZXMiLCJzZWxlY3RlZEluZGV4ZXMiLCJzZWxlY3RlZEdlb21ldHJ5IiwiZ2V0U2VsZWN0ZWRHZW9tZXRyeSIsInRlbnRhdGl2ZUZlYXR1cmUiLCJnZXRUZW50YXRpdmVGZWF0dXJlIiwiY2xpY2tTZXF1ZW5jZSIsImdldENsaWNrU2VxdWVuY2UiLCJsZW5ndGgiLCJ0eXBlIiwiY29uc29sZSIsIndhcm4iLCJyZXNldENsaWNrU2VxdWVuY2UiLCJsaW5lU3RyaW5nIiwicG9zaXRpb25JbmRleGVzIiwiY29vcmRpbmF0ZXMiLCJtb2RlQ29uZmlnIiwiZHJhd0F0RnJvbnQiLCJmZWF0dXJlSW5kZXgiLCJ1cGRhdGVkRGF0YSIsIkltbXV0YWJsZUZlYXR1cmVDb2xsZWN0aW9uIiwiZGF0YSIsImFkZFBvc2l0aW9uIiwibWFwQ29vcmRzIiwiZ2V0T2JqZWN0IiwiZWRpdFR5cGUiLCJlZGl0Q29udGV4dCIsImZlYXR1cmVJbmRleGVzIiwicG9zaXRpb24iLCJnZW9tZXRyeSIsImdldEFkZEZlYXR1cmVBY3Rpb24iLCJoYW5kbGVQb2ludGVyTW92ZUFkYXB0ZXIiLCJyZXN1bHQiLCJjYW5jZWxNYXBQYW4iLCJzdGFydFBvc2l0aW9uIiwiX3NldFRlbnRhdGl2ZUZlYXR1cmUiLCJwcm9wZXJ0aWVzIiwiZ2V0Q3Vyc29yQWRhcHRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUlBOztBQUNBOztBQUVPLE1BQU1BLGtCQUFOLFNBQWlDQyxvQ0FBakMsQ0FBcUQ7QUFDMURDLEVBQUFBLGtCQUFrQixDQUFDQyxLQUFELEVBQW9CQyxLQUFwQixFQUE2RTtBQUM3RixVQUFNRixrQkFB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QUZqRCxFQUdFO0FBQ0E7QUFDQSxhQUFPdUIsTUFBUDtBQUNEOztBQUVELFFBQUk5QixnQkFBZ0IsSUFBSUEsZ0JBQWdCLENBQUNPLElBQWpCLEtBQTBCLFlBQWxELEVBQWdFO0FBQzlEO0FBQ0F5QixNQUFBQSxhQUFhLEdBQUdoQyxnQkFBZ0IsQ0FBQ2EsV0FBakIsQ0FBNkJiLGdCQUFnQixDQUFDYSxXQUFqQixDQUE2QlAsTUFBN0IsR0FBc0MsQ0FBbkUsQ0FBaEI7QUFFQSxVQUFNUSxVQUFVLEdBQUdsQixLQUFLLENBQUNrQixVQUF6Qjs7QUFDQSxVQUFJQSxVQUFVLElBQUlBLFVBQVUsQ0FBQ0MsV0FBN0IsRUFBMEM7QUFDeENpQixRQUFBQSxhQUFhLEdBQUdoQyxnQkFBZ0IsQ0FBQ2EsV0FBakIsQ0FBNkIsQ0FBN0IsQ0FBaEI7QUFDRDtBQUNGLEtBUkQsTUFRTyxJQUFJVCxhQUFhLENBQUNFLE1BQWQsS0FBeUIsQ0FBN0IsRUFBZ0M7QUFDckMwQixNQUFBQSxhQUFhLEdBQUc1QixhQUFhLENBQUMsQ0FBRCxDQUE3QjtBQUNEOztBQUVELFFBQUk0QixhQUFKLEVBQW1CO0FBQ2pCLFdBQUtDLG9CQUFMLENBQTBCO0FBQ3hCMUIsUUFBQUEsSUFBSSxFQUFFLFNBRGtCO0FBRXhCMkIsUUFBQUEsVUFBVSxFQUFFLEVBRlk7QUFHeEJQLFFBQUFBLFFBQVEsRUFBRTtBQUNScEIsVUFBQUEsSUFBSSxFQUFFLFlBREU7QUFFUk0sVUFBQUEsV0FBVyxFQUFFLENBQUNtQixhQUFELEVBQWdCWCxTQUFoQjtBQUZMO0FBSGMsT0FBMUI7QUFRRDs7QUFFRCxXQUFPUyxNQUFQO0FBQ0Q7O0FBRURLLEVBQUFBLGdCQUFnQixHQUFHO0FBQ2pCLFdBQU8sTUFBUDtBQUNEOztBQXpHeUQiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuXG5pbXBvcnQgdHlwZSB7IFBvc2l0aW9uLCBMaW5lU3RyaW5nLCBGZWF0dXJlQ29sbGVjdGlvbiB9IGZyb20gJy4uL2dlb2pzb24tdHlwZXMuanMnO1xuaW1wb3J0IHR5cGUgeyBDbGlja0V2ZW50LCBQb2ludGVyTW92ZUV2ZW50LCBNb2RlUHJvcHMgfSBmcm9tICcuLi90eXBlcy5qcyc7XG5pbXBvcnQgeyBCYXNlR2VvSnNvbkVkaXRNb2RlLCB0eXBlIEdlb0pzb25FZGl0QWN0aW9uIH0gZnJvbSAnLi9nZW9qc29uLWVkaXQtbW9kZS5qcyc7XG5pbXBvcnQgeyBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbiB9IGZyb20gJy4vaW1tdXRhYmxlLWZlYXR1cmUtY29sbGVjdGlvbi5qcyc7XG5cbmV4cG9ydCBjbGFzcyBEcmF3TGluZVN0cmluZ01vZGUgZXh0ZW5kcyBCYXNlR2VvSnNvbkVkaXRNb2RlIHtcbiAgaGFuZGxlQ2xpY2tBZGFwdGVyKGV2ZW50OiBDbGlja0V2ZW50LCBwcm9wczogTW9kZVByb3BzPEZlYXR1cmVDb2xsZWN0aW9uPik6ID9HZW9Kc29uRWRpdEFjdGlvbiB7XG4gICAgc3VwZXIuaGFuZGxlQ2xpY2tBZGFwdGVyKGV2ZW50LCBwcm9wcyk7XG5cbiAgICBsZXQgZWRpdEFjdGlvbjogP0dlb0pzb25FZGl0QWN0aW9uID0gbnVsbDtcbiAgICBjb25zdCBzZWxlY3RlZEZlYXR1cmVJbmRleGVzID0gcHJvcHMuc2VsZWN0ZWRJbmRleGVzO1xuICAgIGNvbnN0IHNlbGVjdGVkR2VvbWV0cnkgPSB0aGlzLmdldFNlbGVjdGVkR2VvbWV0cnkocHJvcHMpO1xuICAgIGNvbnN0IHRlbnRhdGl2ZUZlYXR1cmUgPSB0aGlzLmdldFRlbnRhdGl2ZUZlYXR1cmUoKTtcbiAgICBjb25zdCBjbGlja1NlcXVlbmNlID0gdGhpcy5nZXRDbGlja1NlcXVlbmNlKCk7XG5cbiAgICBpZiAoXG4gICAgICBzZWxlY3RlZEZlYXR1cmVJbmRleGVzLmxlbmd0aCA+IDEgfHxcbiAgICAgIChzZWxlY3RlZEdlb21ldHJ5ICYmIHNlbGVjdGVkR2VvbWV0cnkudHlwZSAhPT0gJ0xpbmVTdHJpbmcnKVxuICAgICkge1xuICAgICAgY29uc29sZS53YXJuKGBkcmF3TGluZVN0cmluZyBtb2RlIG9ubHkgc3VwcG9ydGVkIGZvciBzaW5nbGUgTGluZVN0cmluZyBzZWxlY3Rpb25gKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgICAgdGhpcy5yZXNldENsaWNrU2VxdWVuY2UoKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmIChzZWxlY3RlZEdlb21ldHJ5ICYmIHNlbGVjdGVkR2VvbWV0cnkudHlwZSA9PT0gJ0xpbmVTdHJpbmcnKSB7XG4gICAgICAvLyBFeHRlbmQgdGhlIExpbmVTdHJpbmdcbiAgICAgIGNvbnN0IGxpbmVTdHJpbmc6IExpbmVTdHJpbmcgPSBzZWxlY3RlZEdlb21ldHJ5O1xuXG4gICAgICBsZXQgcG9zaXRpb25JbmRleGVzID0gW2xpbmVTdHJpbmcuY29vcmRpbmF0ZXMubGVuZ3RoXTtcblxuICAgICAgY29uc3QgbW9kZUNvbmZpZyA9IHByb3BzLm1vZGVDb25maWc7XG4gICAgICBpZiAobW9kZUNvbmZpZyAmJiBtb2RlQ29uZmlnLmRyYXdBdEZyb250KSB7XG4gICAgICAgIHBvc2l0aW9uSW5kZXhlcyA9IFswXTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZlYXR1cmVJbmRleCA9IHNlbGVjdGVkRmVhdHVyZUluZGV4ZXNbMF07XG4gICAgICBjb25zdCB1cGRhdGVkRGF0YSA9IG5ldyBJbW11dGFibGVGZWF0dXJlQ29sbGVjdGlvbihwcm9wcy5kYXRhKVxuICAgICAgICAuYWRkUG9zaXRpb24oZmVhdHVyZUluZGV4LCBwb3NpdGlvbkluZGV4ZXMsIGV2ZW50Lm1hcENvb3JkcylcbiAgICAgICAgLmdldE9iamVjdCgpO1xuXG4gICAgICBlZGl0QWN0aW9uID0ge1xuICAgICAgICB1cGRhdGVkRGF0YSxcbiAgICAgICAgZWRpdFR5cGU6ICdhZGRQb3NpdGlvbicsXG4gICAgICAgIGVkaXRDb250ZXh0OiB7XG4gICAgICAgICAgZmVhdHVyZUluZGV4ZXM6IFtmZWF0dXJlSW5kZXhdLFxuICAgICAgICAgIHBvc2l0aW9uSW5kZXhlcyxcbiAgICAgICAgICBwb3NpdGlvbjogZXZlbnQubWFwQ29vcmRzXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHRoaXMucmVzZXRDbGlja1NlcXVlbmNlKCk7XG4gICAgfSBlbHNlIGlmIChjbGlja1NlcXVlbmNlLmxlbmd0aCA9PT0gMiAmJiB0ZW50YXRpdmVGZWF0dXJlKSB7XG4gICAgICAvLyBBZGQgYSBuZXcgTGluZVN0cmluZ1xuICAgICAgY29uc3QgZ2VvbWV0cnk6IGFueSA9IHRlbnRhdGl2ZUZlYXR1cmUuZ2VvbWV0cnk7XG4gICAgICBlZGl0QWN0aW9uID0gdGhpcy5nZXRBZGRGZWF0dXJlQWN0aW9uKGdlb21ldHJ5LCBwcm9wcy5kYXRhKTtcblxuICAgICAgdGhpcy5yZXNldENsaWNrU2VxdWVuY2UoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZWRpdEFjdGlvbjtcbiAgfVxuXG4gIGhhbmRsZVBvaW50ZXJNb3ZlQWRhcHRlcihcbiAgICBldmVudDogUG9pbnRlck1vdmVFdmVudCxcbiAgICBwcm9wczogTW9kZVByb3BzPEZlYXR1cmVDb2xsZWN0aW9uPlxuICApOiB7IGVkaXRBY3Rpb246ID9HZW9Kc29uRWRpdEFjdGlvbiwgY2FuY2VsTWFwUGFuOiBib29sZWFuIH0ge1xuICAgIGNvbnN0IHJlc3VsdCA9IHsgZWRpdEFjdGlvbjogbnVsbCwgY2FuY2VsTWFwUGFuOiBmYWxzZSB9O1xuXG4gICAgY29uc3QgY2xpY2tTZXF1ZW5jZSA9IHRoaXMuZ2V0Q2xpY2tTZXF1ZW5jZSgpO1xuICAgIGNvbnN0IG1hcENvb3JkcyA9IGV2ZW50Lm1hcENvb3JkcztcblxuICAgIGxldCBzdGFydFBvc2l0aW9uOiA/UG9zaXRpb24gPSBudWxsO1xuICAgIGNvbnN0IHNlbGVjdGVkRmVhdHVyZUluZGV4ZXMgPSBwcm9wcy5zZWxlY3RlZEluZGV4ZXM7XG4gICAgY29uc3Qgc2VsZWN0ZWRHZW9tZXRyeSA9IHRoaXMuZ2V0U2VsZWN0ZWRHZW9tZXRyeShwcm9wcyk7XG5cbiAgICBpZiAoXG4gICAgICBzZWxlY3RlZEZlYXR1cmVJbmRleGVzLmxlbmd0aCA+IDEgfHxcbiAgICAgIChzZWxlY3RlZEdlb21ldHJ5ICYmIHNlbGVjdGVkR2VvbWV0cnkudHlwZSAhPT0gJ0xpbmVTdHJpbmcnKVxuICAgICkge1xuICAgICAgLy8gdW5zdXBwb3J0ZWRcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgaWYgKHNlbGVjdGVkR2VvbWV0cnkgJiYgc2VsZWN0ZWRHZW9tZXRyeS50eXBlID09PSAnTGluZVN0cmluZycpIHtcbiAgICAgIC8vIERyYXcgYW4gZXh0ZW5zaW9uIGxpbmUgc3RhcnRpbmcgZnJvbSBvbmUgZW5kIG9mIHRoZSBzZWxlY3RlZCBMaW5lU3RyaW5nXG4gICAgICBzdGFydFBvc2l0aW9uID0gc2VsZWN0ZWRHZW9tZXRyeS5jb29yZGluYXRlc1tzZWxlY3RlZEdlb21ldHJ5LmNvb3JkaW5hdGVzLmxlbmd0aCAtIDFdO1xuXG4gICAgICBjb25zdCBtb2RlQ29uZmlnID0gcHJvcHMubW9kZUNvbmZpZztcbiAgICAgIGlmIChtb2RlQ29uZmlnICYmIG1vZGVDb25maWcuZHJhd0F0RnJvbnQpIHtcbiAgICAgICAgc3RhcnRQb3NpdGlvbiA9IHNlbGVjdGVkR2VvbWV0cnkuY29vcmRpbmF0ZXNbMF07XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChjbGlja1NlcXVlbmNlLmxlbmd0aCA9PT0gMSkge1xuICAgICAgc3RhcnRQb3NpdGlvbiA9IGNsaWNrU2VxdWVuY2VbMF07XG4gICAgfVxuXG4gICAgaWYgKHN0YXJ0UG9zaXRpb24pIHtcbiAgICAgIHRoaXMuX3NldFRlbnRhdGl2ZUZlYXR1cmUoe1xuICAgICAgICB0eXBlOiAnRmVhdHVyZScsXG4gICAgICAgIHByb3BlcnRpZXM6IHt9LFxuICAgICAgICBnZW9tZXRyeToge1xuICAgICAgICAgIHR5cGU6ICdMaW5lU3RyaW5nJyxcbiAgICAgICAgICBjb29yZGluYXRlczogW3N0YXJ0UG9zaXRpb24sIG1hcENvb3Jkc11cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGdldEN1cnNvckFkYXB0ZXIoKSB7XG4gICAgcmV0dXJuICdjZWxsJztcbiAgfVxufVxuIl19